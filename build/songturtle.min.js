/*! songturtle 2019-10-22 */

!function(t){function e(){if(!(this instanceof e))return arguments.length>1||"number"!=typeof arguments[0]?e.apply(new e(arguments.length),arguments):new e(arguments[0]);if(0===arguments.length)throw new Error("Missing Argument: You must pass a valid buffer length");return this.size=this.start=0,this.overflow=null,arguments.length>1||"number"!=typeof arguments[0]?(this.data=new Float32Array(arguments.length),this.end=(this.length=arguments.length)-1,this.push.apply(this,arguments)):(this.data=new Float32Array(arguments[0]),this.end=(this.length=arguments[0])-1),this}function s(t,e){return t==e?0:t>e?1:-1}e.prototype={constructor:e,pop:function(){var t;if(0!==this.size)return t=this.data[this.end],delete this.data[this.end],this.end=(this.end-1+this.length)%this.length,this.size--,t},push:function(){var t=0;if(this.overflow&&this.size+arguments.length>this.length)for(;t<this.size+arguments.length-this.length;t++)this.overflow(this.data[(this.end+t+1)%this.length],this);for(t=0;t<arguments.length;t++)this.data[(this.end+t+1)%this.length]=arguments[t];return this.size<this.length&&(this.size+t>this.length?this.size=this.length:this.size+=t),this.end=(this.end+t)%this.length,this.start=(this.length+this.end-this.size+1)%this.length,this.size},reverse:function(){for(var t,e=0;e<~~(this.size/2);e++)t=this.data[(this.start+e)%this.length],this.data[(this.start+e)%this.length]=this.data[(this.start+(this.size-e-1))%this.length],this.data[(this.start+(this.size-e-1))%this.length]=t;return this},rotateLeft:function(t){if(void 0===t&&(t=1),"number"!=typeof t)throw new Error("Argument must be a number");for(;--t>=0;)this.push(this.shift());return this},rotateRight:function(t){if(void 0===t&&(t=1),"number"!=typeof t)throw new Error("Argument must be a number");for(;--t>=0;)this.unshift(this.pop());return this},shift:function(){var t;if(0!==this.size)return t=this.data[this.start],this.start=(this.start+1)%this.length,this.size--,t},sort:function(t){return this},unshift:function(){var t=0;if(this.overflow&&this.size+arguments.length>this.length)for(;t<this.size+arguments.length-this.length;t++)this.overflow(this.data[this.end-t%this.length],this);for(t=0;t<arguments.length;t++)this.data[(this.length+this.start-t%this.length-1)%this.length]=arguments[t];return this.length-this.size-t<0&&(this.end+=this.length-this.size-t,this.end<0&&(this.end=this.length+this.end%this.length)),this.size<this.length&&(this.size+t>this.length?this.size=this.length:this.size+=t),this.start-=arguments.length,this.start<0&&(this.start=this.length+this.start%this.length),this.size},indexOf:function(t,e){for(e||(e=0);e<this.size;e++)if(this.data[(this.start+e)%this.length]===t)return e;return-1},lastIndexOf:function(t,e){for(e||(e=this.size-1);e>=0;e--)if(this.data[(this.start+e)%this.length]===t)return e;return-1},sortedIndex:function(t,e,i){e=e||s;var a=this.start,n=this.size-1;for(a&&e.call(i,t,this.data[n])>0&&(a=0,n=this.end);a<n;){var h=a+n>>>1;e.call(i,t,this.data[h])>0?a=h+1:n=h}return((a-this.start)%this.size+this.size)%this.size},every:function(t,e){for(var s=0;s<this.size;s++)if(!t.call(e,this.data[(this.start+s)%this.length],s,this))return!1;return!0},forEach:function(t,e){for(var s=0;s<this.size;s++)t.call(e,this.data[(this.start+s)%this.length],s,this)},some:function(t,e){for(var s=0;s<this.size;s++)if(t.call(e,this.data[(this.start+s)%this.length],s,this))return!0;return!1},avg:function(){return 0==this.size?0:this.sum()/this.size},sum:function(){for(var t=this.size,e=0;t--;)e+=this.data[t];return e},median:function(){if(0===this.size)return 0;var t=this.slice().sort(s),e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2},empty:function(){return this.size=this.start=0,this.end=this.length-1,this},fill:function(t){var e=0;if("function"==typeof t)for(;this.data[e]=t(),++e<this.length;);else for(;this.data[e]=t,++e<this.length;);return this.start=0,this.end=this.length-1,this.size=this.length,this},first:function(){return this.data[this.start]},last:function(){return this.data[this.end]},get:function(t){return this.data[(this.start+t)%this.length]},isFull:function(t){return this.length===this.size},set:function(t,e){return this.data[(this.start+t)%this.length]=e},toArray:function(){return this.slice()},slice:function(t,e){var s=this.size;if((t=+t||0)<0){if(t>=e)return[];t=-t>s?0:s+t}null==e||e>s?e=s:e<0?e+=s:e=+e||0,s=t<e?e-t:0;for(var i=Array(s),a=0;a<s;a++)i[a]=this.data[(this.start+t+a)%this.length];return i}},"object"==typeof module&&module.exports?module.exports=e:t.CBuffer=e}(this);var DSP={LEFT:0,RIGHT:1,MIX:2,SINE:1,TRIANGLE:2,SAW:3,SQUARE:4,LOWPASS:0,HIGHPASS:1,BANDPASS:2,NOTCH:3,BARTLETT:1,BARTLETTHANN:2,BLACKMAN:3,COSINE:4,GAUSS:5,HAMMING:6,HANN:7,LANCZOS:8,RECTANGULAR:9,TRIANGULAR:10,OFF:0,FW:1,BW:2,FWBW:3,TWO_PI:2*Math.PI};function setupTypedArray(t,e){"function"!=typeof this[t]&&"object"!=typeof this[t]&&("function"==typeof this[e]&&"object"!=typeof this[e]?this[t]=this[e]:this[t]=function(t){return t instanceof Array?t:"number"==typeof t?new Array(t):void 0})}function FourierTransform(t,e){this.bufferSize=t,this.sampleRate=e,this.bandwidth=2/t*e/2,this.spectrum=new Float32Array(t/2),this.real=new Float32Array(t),this.imag=new Float32Array(t),this.peakBand=0,this.peak=0,this.getBandFrequency=function(t){return this.bandwidth*t+this.bandwidth/2},this.calculateSpectrum=function(){for(var e,s,i,a=this.spectrum,n=this.real,h=this.imag,r=2/this.bufferSize,o=Math.sqrt,l=0,u=t/2;l<u;l++)(i=r*o((e=n[l])*e+(s=h[l])*s))>this.peak&&(this.peakBand=l,this.peak=i),a[l]=i}}function DFT(t,e){FourierTransform.call(this,t,e);var s=t/2*t,i=2*Math.PI;this.sinTable=new Float32Array(s),this.cosTable=new Float32Array(s);for(var a=0;a<s;a++)this.sinTable[a]=Math.sin(a*i/t),this.cosTable[a]=Math.cos(a*i/t)}function FFT(t,e){FourierTransform.call(this,t,e),this.reverseTable=new Uint32Array(t);for(var s,i=1,a=t>>1;i<t;){for(s=0;s<i;s++)this.reverseTable[s+i]=this.reverseTable[s]+a;i<<=1,a>>=1}for(this.sinTable=new Float32Array(t),this.cosTable=new Float32Array(t),s=0;s<t;s++)this.sinTable[s]=Math.sin(-Math.PI/s),this.cosTable[s]=Math.cos(-Math.PI/s)}function RFFT(t,e){FourierTransform.call(this,t,e),this.trans=new Float32Array(t),this.reverseTable=new Uint32Array(t),this.reverseBinPermute=function(t,e){var s,i=this.bufferSize,a=i>>>1,n=i-1,h=1,r=0;t[0]=e[0];do{for(r+=a,t[h]=e[r],t[r]=e[h],h++,s=a<<1;!((r^=s>>=1)&s););r>=h&&(t[h]=e[r],t[r]=e[h],t[n-h]=e[n-r],t[n-r]=e[n-h]),h++}while(h<a);t[n]=e[n]},this.generateReverseTable=function(){var t,e=this.bufferSize,s=e>>>1,i=e-1,a=1,n=0;this.reverseTable[0]=0;do{for(n+=s,this.reverseTable[a]=n,this.reverseTable[n]=a,a++,t=s<<1;!((n^=t>>=1)&t););n>=a&&(this.reverseTable[a]=n,this.reverseTable[n]=a,this.reverseTable[i-a]=i-n,this.reverseTable[i-n]=i-a),a++}while(a<s);this.reverseTable[i]=i},this.generateReverseTable()}function Sampler(t,e,s,i,a,n,h,r){this.file=t,this.bufferSize=e,this.sampleRate=s,this.playStart=i||0,this.playEnd=a||1,this.loopStart=n||0,this.loopEnd=h||1,this.loopMode=r||DSP.OFF,this.loaded=!1,this.samples=[],this.signal=new Float32Array(e),this.frameCount=0,this.envelope=null,this.amplitude=1,this.rootFrequency=110,this.frequency=550,this.step=this.frequency/this.rootFrequency,this.duration=0,this.samplesProcessed=0,this.playhead=0;var o=document.createElement("AUDIO"),l=this;this.loadSamples=function(t){for(var e=DSP.getChannel(DSP.MIX,t.frameBuffer),s=0;s<e.length;s++)l.samples.push(e[s])},this.loadComplete=function(){l.samples=new Float32Array(l.samples),l.loaded=!0},this.loadMetaData=function(){l.duration=o.duration},o.addEventListener("MozAudioAvailable",this.loadSamples,!1),o.addEventListener("loadedmetadata",this.loadMetaData,!1),o.addEventListener("ended",this.loadComplete,!1),o.muted=!0,o.src=t,o.play()}function Oscillator(t,e,s,i,a){switch(this.frequency=e,this.amplitude=s,this.bufferSize=i,this.sampleRate=a,this.frameCount=0,this.waveTableLength=2048,this.cyclesPerSample=e/a,this.signal=new Float32Array(i),this.envelope=null,parseInt(t,10)){case DSP.TRIANGLE:this.func=Oscillator.Triangle;break;case DSP.SAW:this.func=Oscillator.Saw;break;case DSP.SQUARE:this.func=Oscillator.Square;break;default:case DSP.SINE:this.func=Oscillator.Sine}this.generateWaveTable=function(){Oscillator.waveTable[this.func]=new Float32Array(2048);for(var t=1/(this.waveTableLength/this.sampleRate),e=0;e<this.waveTableLength;e++)Oscillator.waveTable[this.func][e]=this.func(e*t/this.sampleRate)},void 0===Oscillator.waveTable&&(Oscillator.waveTable={}),void 0===Oscillator.waveTable[this.func]&&this.generateWaveTable(),this.waveTable=Oscillator.waveTable[this.func]}function ADSR(t,e,s,i,a,n){this.sampleRate=n,this.attackLength=t,this.decayLength=e,this.sustainLevel=s,this.sustainLength=i,this.releaseLength=a,this.sampleRate=n,this.attackSamples=t*n,this.decaySamples=e*n,this.sustainSamples=i*n,this.releaseSamples=a*n,this.update=function(){this.attack=this.attackSamples,this.decay=this.attack+this.decaySamples,this.sustain=this.decay+this.sustainSamples,this.release=this.sustain+this.releaseSamples},this.update(),this.samplesProcessed=0}function IIRFilter(t,e,s,i){switch(this.sampleRate=i,t){case DSP.LOWPASS:case DSP.LP12:this.func=new IIRFilter.LP12(e,s,i)}}function IIRFilter2(t,e,s,i){this.type=t,this.cutoff=e,this.resonance=s,this.sampleRate=i,this.f=Float32Array(4),this.f[0]=0,this.f[1]=0,this.f[2]=0,this.f[3]=0,this.calcCoeff=function(t,e){this.freq=2*Math.sin(Math.PI*Math.min(.25,t/(2*this.sampleRate))),this.damp=Math.min(2*(1-Math.pow(e,.25)),Math.min(2,2/this.freq-.5*this.freq))},this.calcCoeff(e,s)}function WindowFunction(t,e){switch(this.alpha=e,t){case DSP.BARTLETT:this.func=WindowFunction.Bartlett;break;case DSP.BARTLETTHANN:this.func=WindowFunction.BartlettHann;break;case DSP.BLACKMAN:this.func=WindowFunction.Blackman,this.alpha=this.alpha||.16;break;case DSP.COSINE:this.func=WindowFunction.Cosine;break;case DSP.GAUSS:this.func=WindowFunction.Gauss,this.alpha=this.alpha||.25;break;case DSP.HAMMING:this.func=WindowFunction.Hamming;break;case DSP.HANN:this.func=WindowFunction.Hann;break;case DSP.LANCZOS:this.func=WindowFunction.Lanczoz;break;case DSP.RECTANGULAR:this.func=WindowFunction.Rectangular;break;case DSP.TRIANGULAR:this.func=WindowFunction.Triangular}}function sinh(t){return(Math.exp(t)-Math.exp(-t))/2}function Biquad(t,e){this.Fs=e,this.type=t,this.parameterType=DSP.Q,this.x_1_l=0,this.x_2_l=0,this.y_1_l=0,this.y_2_l=0,this.x_1_r=0,this.x_2_r=0,this.y_1_r=0,this.y_2_r=0,this.b0=1,this.a0=1,this.b1=0,this.a1=0,this.b2=0,this.a2=0,this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0,this.f0=3e3,this.dBgain=12,this.Q=1,this.BW=-3,this.S=1,this.coefficients=function(){return{b:[this.b0,this.b1,this.b2],a:[this.a0,this.a1,this.a2]}},this.setFilterType=function(t){this.type=t,this.recalculateCoefficients()},this.setSampleRate=function(t){this.Fs=t,this.recalculateCoefficients()},this.setQ=function(t){this.parameterType=DSP.Q,this.Q=Math.max(Math.min(t,115),.001),this.recalculateCoefficients()},this.setBW=function(t){this.parameterType=DSP.BW,this.BW=t,this.recalculateCoefficients()},this.setS=function(t){this.parameterType=DSP.S,this.S=Math.max(Math.min(t,5),1e-4),this.recalculateCoefficients()},this.setF0=function(t){this.f0=t,this.recalculateCoefficients()},this.setDbGain=function(t){this.dBgain=t,this.recalculateCoefficients()},this.recalculateCoefficients=function(){var e;e=t===DSP.PEAKING_EQ||t===DSP.LOW_SHELF||t===DSP.HIGH_SHELF?Math.pow(10,this.dBgain/40):Math.sqrt(Math.pow(10,this.dBgain/20));var s,i=DSP.TWO_PI*this.f0/this.Fs,a=Math.cos(i),n=Math.sin(i),h=0;switch(this.parameterType){case DSP.Q:h=n/(2*this.Q);break;case DSP.BW:h=n*sinh(Math.LN2/2*this.BW*i/n);break;case DSP.S:h=n/2*Math.sqrt((e+1/e)*(1/this.S-1)+2)}switch(this.type){case DSP.LPF:this.b0=(1-a)/2,this.b1=1-a,this.b2=(1-a)/2,this.a0=1+h,this.a1=-2*a,this.a2=1-h;break;case DSP.HPF:this.b0=(1+a)/2,this.b1=-(1+a),this.b2=(1+a)/2,this.a0=1+h,this.a1=-2*a,this.a2=1-h;break;case DSP.BPF_CONSTANT_SKIRT:this.b0=n/2,this.b1=0,this.b2=-n/2,this.a0=1+h,this.a1=-2*a,this.a2=1-h;break;case DSP.BPF_CONSTANT_PEAK:this.b0=h,this.b1=0,this.b2=-h,this.a0=1+h,this.a1=-2*a,this.a2=1-h;break;case DSP.NOTCH:this.b0=1,this.b1=-2*a,this.b2=1,this.a0=1+h,this.a1=-2*a,this.a2=1-h;break;case DSP.APF:this.b0=1-h,this.b1=-2*a,this.b2=1+h,this.a0=1+h,this.a1=-2*a,this.a2=1-h;break;case DSP.PEAKING_EQ:this.b0=1+h*e,this.b1=-2*a,this.b2=1-h*e,this.a0=1+h/e,this.a1=-2*a,this.a2=1-h/e;break;case DSP.LOW_SHELF:s=n*Math.sqrt((3^e)*(1/this.S-1)+2*e),this.b0=e*(e+1-(e-1)*a+s),this.b1=2*e*(e-1-(e+1)*a),this.b2=e*(e+1-(e-1)*a-s),this.a0=e+1+(e-1)*a+s,this.a1=-2*(e-1+(e+1)*a),this.a2=e+1+(e-1)*a-s;break;case DSP.HIGH_SHELF:s=n*Math.sqrt((3^e)*(1/this.S-1)+2*e),this.b0=e*(e+1+(e-1)*a+s),this.b1=-2*e*(e-1+(e+1)*a),this.b2=e*(e+1+(e-1)*a-s),this.a0=e+1-(e-1)*a+s,this.a1=2*(e-1-(e+1)*a),this.a2=e+1-(e-1)*a-s}this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0},this.process=function(t){for(var e=t.length,s=new Float32Array(e),i=0;i<t.length;i++)s[i]=this.b0a0*t[i]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=s[i],this.x_2_l=this.x_1_l,this.x_1_l=t[i];return s},this.processStereo=function(t){for(var e=t.length,s=new Float32Array(e),i=0;i<e/2;i++)s[2*i]=this.b0a0*t[2*i]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=s[2*i],this.x_2_l=this.x_1_l,this.x_1_l=t[2*i],s[2*i+1]=this.b0a0*t[2*i+1]+this.b1a0*this.x_1_r+this.b2a0*this.x_2_r-this.a1a0*this.y_1_r-this.a2a0*this.y_2_r,this.y_2_r=this.y_1_r,this.y_1_r=s[2*i+1],this.x_2_r=this.x_1_r,this.x_1_r=t[2*i+1];return s}}function GraphicalEq(t){this.FS=t,this.minFreq=40,this.maxFreq=16e3,this.bandsPerOctave=1,this.filters=[],this.freqzs=[],this.calculateFreqzs=!0,this.recalculateFilters=function(){var t=Math.round(Math.log(this.maxFreq/this.minFreq)*this.bandsPerOctave/Math.LN2);this.filters=[];for(var e=0;e<t;e++){var s=this.minFreq*Math.pow(2,e/this.bandsPerOctave),i=new Biquad(DSP.PEAKING_EQ,this.FS);i.setDbGain(0),i.setBW(1/this.bandsPerOctave),i.setF0(s),this.filters[e]=i,this.recalculateFreqz(e)}},this.setMinimumFrequency=function(t){this.minFreq=t,this.recalculateFilters()},this.setMaximumFrequency=function(t){this.maxFreq=t,this.recalculateFilters()},this.setBandsPerOctave=function(t){this.bandsPerOctave=t,this.recalculateFilters()},this.setBandGain=function(t,e){if(t<0||t>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds.";if(!e)throw"A gain must be passed.";this.filters[t].setDbGain(e),this.recalculateFreqz(t)},this.recalculateFreqz=function(t){if(this.calculateFreqzs){if(t<0||t>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds. "+t+" is out of [0, "+this.filters.length-1+"]";if(!this.w){this.w=Float32Array(400);for(var e=0;e<this.w.length;e++)this.w[e]=Math.PI/this.w.length*e}var s=[this.filters[t].b0,this.filters[t].b1,this.filters[t].b2],i=[this.filters[t].a0,this.filters[t].a1,this.filters[t].a2];this.freqzs[t]=DSP.mag2db(DSP.freqz(s,i,this.w))}},this.process=function(t){for(var e=t,s=0;s<this.filters.length;s++)e=this.filters[s].process(e);return e},this.processStereo=function(t){for(var e=t,s=0;s<this.filters.length;s++)e=this.filters[s].processStereo(e);return e}}function MultiDelay(t,e,s,i){this.delayBufferSamples=new Float32Array(t),this.delayInputPointer=e,this.delayOutputPointer=0,this.delayInSamples=e,this.masterVolume=s,this.delayVolume=i}function SingleDelay(t,e,s){this.delayBufferSamples=new Float32Array(t),this.delayInputPointer=e,this.delayOutputPointer=0,this.delayInSamples=e,this.delayVolume=s}function Reverb(t,e,s,i,a,n){var h,r;for(this.delayInSamples=e,this.masterVolume=s,this.mixVolume=i,this.delayVolume=a,this.dampFrequency=n,this.NR_OF_MULTIDELAYS=6,this.NR_OF_SINGLEDELAYS=6,this.LOWPASSL=new IIRFilter2(DSP.LOWPASS,n,0,44100),this.LOWPASSR=new IIRFilter2(DSP.LOWPASS,n,0,44100),this.singleDelays=[],h=0;h<this.NR_OF_SINGLEDELAYS;h++)r=1+h/7,this.singleDelays[h]=new SingleDelay(t,Math.round(this.delayInSamples*r),this.delayVolume);for(this.multiDelays=[],h=0;h<this.NR_OF_MULTIDELAYS;h++)r=1+h/10,this.multiDelays[h]=new MultiDelay(t,Math.round(this.delayInSamples*r),this.masterVolume,this.delayVolume)}function PhaseVocoder(t,e){var s,i,a,n,h,r,o,l,u,c,f,p,d,m=0,y=0,g=t,v=1,S=new FFT(g,e),b=Math.sqrt,P=Math.cos,w=Math.sin,_=Math.atan2,F=Math.round,A=Math.max,D=Math.ceil,T=Math.pow,M=Math.PI,I=F(g/2)+1,E={fftObj:{real:new Float32Array(I),imag:new Float32Array(I),magnitude:new Float32Array(I),phase:new Float32Array(I)},pvOut:{real:C(g,0,Float32Array),imag:C(g,0,Float32Array),magnitude:C(g,0,Float32Array),phase:C(g,0,Float32Array)},processedFrame:new Float32Array(g)},L={instPhaseAdv:new Float32Array(I),phTh:new Float32Array(I)},B={_inputFrame:new Float32Array(g),_zeros:new Float32Array(g)},R=0,O=2*M;function C(t,e,s){for(var i=new(s||Array)(t),a=0;a<t;a++)i[a]=e;return i}this.process=function(t,e){var v=m,S=y,b=E.processedFrame,T=E.fftObj,M=E.pvOut;return this.STFT(t,n,I,T),function(t,e,s,i,a,n,h){var r,o,m,y,g,v,S=t.phase,b=t.magnitude,T=(L.instPhaseAdv,L.phTh);for(R=0,M=0;M<i.length;M++)if(l=i[M]*a,u=S[M]-e[M]-l,c=u-O*F(u/O),f=i[M]+c/a,p=f*n,b[M]>A(0|b[M-2],0|b[M-1],0|b[M+1],0|b[M+2])){for(y=0|D((o+(r=M))/2),m=A(0,y-1-g+1),g=y,v=0;v<m;v++,R++)T[R]=s[o]+d-S[o];o=r,d=p}for(var M=0;M<T.length;M++){T[M];var I=P(T[M]),E=w(T[M]);h.real[M]=I*t.real[M]-E*t.imag[M],h.imag[M]=I*t.imag[M]+E*t.real[M],h.phase[M]=_(h.imag[M],h.real[M])}}(T,i,a,s,S,v,M),a=M.phase,i=new Float32Array(T.phase),this.ISTFT(M.real,M.imag,n,!1,b),function(t,e,s,i,a,n,h){for(var r,o=0,l=0;l<t;l++)r=a.shift()||0,o=i.shift()||0,h.push(o/(r<.01?1:r)),i.push(0),a.push(0);for(l=0;l<n;l++)o=i.shift(),i.push(e[l]+o),r=a.shift(),a.push(s[l]+r)}(v,b,h,r,o,g,e),v},this.STFT=function(t,e,s,i){this.STFT_drom(t,e,s,i)},this.STFT_drom=function(t,e,s,i){for(var a=e.length,n=B._inputFrame,h=0;h<a;h++)n[h]=t[h]*e[h];S.forward(n),i.real=S.real,i.imag=S.imag;for(var r=i.real,o=i.imag,l=i.phase,u=i.magnitude,c=0;c<a&&c<s;c++)u[c]=1e3*b(o[c]*o[c]+r[c]*r[c]),l[c]=_(o[c],r[c])},this.ISTFT=function(t,e,s,i,a){this.ISTFT_drom(t,e,s,i,a)},this.ISTFT_drom=function(t,e,s,i,a){S.inverse(t,e,a)},this.init=function(){var e;e=t,s=Array.apply(null,Array(e/2+1)).map(function(t,s){return O*s/e}),this.reset_phases_and_overlap_buffers(),n=function(t,e){return Array.apply(null,Array(t)).map(function(s,i){return T(w(M*i/t),e)})}(t,1),h=n.map(function(t,e){return t*t}),this.set_alpha(1)},this.reset_phases_and_overlap_buffers=function(){i=C(t/2,0),a=C(t/2,0),r=new CBuffer(t),o=new CBuffer(t);for(var e=0;e<t;e++)r.push(0),o.push(0);!0},this.reset_phases=function(){i=C(t/2,0),a=C(t/2,0),!0},this.get_previous_input_phase=function(){return i},this.get_previous_output_phase=function(){return a},this.get_analysis_hop=function(){return y},this.get_synthesis_hop=function(){return m},this.get_alpha=function(){return m/y},this.get_framing_window=function(){return n},this.get_squared_framing_window=function(){return h},this.set_alpha=function(t){v=t,y=F(g/(t<=.8?2:t<=1?4:5)),m=F(t*y)},this.get_alpha_step=function(){return 1/y},this.set_hops=function(t,e){y=t,m=e},this.get_specified_alpha=function(){return v},this.set_overlap_factor=function(t){t,this.set_alpha(v)}}function BufferedPV(t){var e=t||4096,s=new PhaseVocoder(e,44100);s.init();var i,a=new PhaseVocoder(e,44100);a.init();var n=0,h=1,r=new CBuffer(Math.round(2*e)),o=new CBuffer(Math.round(2*e));this.process=function(t){if(i){for(var l=0,u=i.getChannelData(0),c=i.getChannelData(0),f=t.getChannelData(0),p=t.getChannelData(1);o.size>0&&l<t.length;){f[y=l++]=r.shift(),p[y]=o.shift()}if(l!=t.length)do{var d=u.subarray(n,n+e),m=c.subarray(n,n+e);void 0!=h&&h!=s.get_alpha()&&(s.set_alpha(h),a.set_alpha(h),h=void 0),s.process(d,r),a.process(m,o);for(var y=l;r.size>0&&y<t.length;y++)f[y]=r.shift(),p[y]=o.shift();l+=s.get_synthesis_hop(),n+=s.get_analysis_hop()}while(l<t.length)}},this.set_audio_buffer=function(t){i=t,n=0,h=1},Object.defineProperties(this,{position:{get:function(){return n},set:function(t){n=t}},alpha:{get:function(){return s.get_alpha()},set:function(t){h=t}}})}function formatTime(t){return`${Math.floor(t/60)}:${padSeconds(Math.floor(t%60))}`}function padSeconds(t){return t<10?`0${t}`:t}function showElement(t,e){e=e||"block","string"==typeof t&&(t=document.getElementById(t)),t.setAttribute("style",`display:${e}`)}function hideElement(t){"string"==typeof t&&(t=document.getElementById(t)),t.setAttribute("style","display:none")}function Waveform(t,e){this.audioBuffer=t,this.length=e,this.maxData=0,this.rms=function(){this.maxData=-1/0;const t=this.audioBuffer.length,e=Math.floor(t/this.length),s=this.audioBuffer.numberOfChannels,i=[];for(var a=0;a<s;a++)i.push(this.audioBuffer.getChannelData(a));const n=new Float32Array(this.length);for(var h=0,r=0;r<t;r+=e){for(var o=0,l=r;l<r+e;l++)for(a=0;a<s;a++)o+=i[a][l]*i[a][l];const t=Math.sqrt(o/(e*s));n[h++]=t,t>this.maxData&&(this.maxData=t)}return n},this.data=this.rms()}function Song(t,e){this.audioCtx=t,this.audioBuffer=e,this.duration=this.audioBuffer.duration,this.intervalId=0,this.BUFFER_SIZE=4096,this.FRAME_SIZE=2048,this.playback=1,this.position=0,this.isPlaying=!1;var s=this.audioCtx.createScriptProcessor(this.BUFFER_SIZE,2),i=new BufferedPV(this.FRAME_SIZE);i.set_audio_buffer(this.audioBuffer);var a=0,n=1;this.onAudioProcess=function(t){this.isPlaying&&(void 0!=n&&(i.alpha=n,n=void 0),void 0!=a&&(i.position=a,a=void 0),i.process(t.outputBuffer),this.position=i.position/this.audioBuffer.sampleRate,this.position>this.duration?(this.stop(),this.reset()):this.looping&&this.position>this.loopEnd&&(a=this.loopStart*this.audioBuffer.sampleRate))},s.onaudioprocess=this.onAudioProcess.bind(this),this.timeStepMs=50,this.waveformLength=200,this.waveform=new Waveform(this.audioBuffer,this.waveformLength),this.looping=!1,this.loopStart=0,this.loopEnd=0,this.startTime=0,this.play=function(t){this.isPlaying||(this._play(t),this.onStartCallback&&this.onStartCallback())},this.gain=this.audioCtx.createGain(),this._play=function(t){void 0!==t&&null!==t&&this.seek(t),"suspended"===this.audioCtx.state&&this.audioCtx.resume(),s.connect(this.gain),this.gain.connect(this.audioCtx.destination),this.isPlaying=!0},this.seek=function(t){t<0&&(t=0),this.looping&&(t>this.loopEnd?t=this.loopStart+(t-this.loopEnd):t<this.loopStart&&(t=this.loopStart)),a=t*this.audioBuffer.sampleRate},this.stop=function(){this.isPlaying&&(this._stop(),this.onStopCallback&&this.onStopCallback())},this._stop=function(){s.disconnect(),this.isPlaying=!1},this.reset=function(){a=0,this.position=0,(i=new BufferedPV(this.FRAME_SIZE)).set_audio_buffer(this.audioBuffer),this.unloop()},this.loop=function(t,e){this.looping=!0,this.loopStart=t,this.loopEnd=e},this.unloop=function(){this.looping=!1,this.loopStart=0,this.loopEnd=0},this.getCurrentTime=function(){return this.audioCtx.currentTime},this.onStartCallback=null,this.onStart=function(t){this.onStartCallback=t},this.onStopCallback=null,this.onStop=function(t){this.onStopCallback=t},this.changePlayback=function(t){0!=t&&(t<.4&&(t=.4),t>2&&(t=2),this.playback=t,n=1/t)}}function Renderer(t,e){this.waveformColor="#000000",this.waveformProgressColor="#ef8a17",this.waveformSelectedColor="#ef2917",this.loopColor="#008148",this.loopProgressColor="#c6c013",this.canvas=t,this.ctx=t.getContext("2d"),this.song=e,this.waveform=e.waveform,this.padding=1,this.scale=(this.canvas.height/2-1)/this.waveform.maxData,this.barWidth=this.canvas.width/this.waveform.length-this.padding,this.selectionBar=null,this.loopStart=null,this.loopEnd=null,this.selectionStart=null,this.selectionEnd=null,this.drawWaveform=function(){if(null==this.canvas||null==this.song||null==this.waveform)return void console.log("canvas, song, or waveform was null; doing nothing.");const t=this.song.position;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=Math.ceil(this.waveform.length/this.waveform.audioBuffer.duration*t);if(this.song.looping){if(null!==this.loopStart&&null!==this.loopEnd&&(this._drawBars(this.waveformColor,0,this.loopStart),this._drawBars(this.loopProgressColor,this.loopStart,e),this._drawBars(this.loopColor,e,this.loopEnd),this._drawBars(this.waveformColor,this.loopEnd)),null!==this.selectionStart&&null!==this.selectionEnd){const t=Math.min(this.selectionStart,this.selectionEnd),e=Math.max(this.selectionStart,this.selectionEnd);this._drawBars(this.loopColor,t,e+1)}}else{if(null!==this.selectionBar){const t=Math.min(this.selectionBar,e),s=t===this.selectionBar?e:this.selectionBar;this._drawBars(this.waveformProgressColor,0,t),this._drawBars(this.waveformSelectedColor,t,s),this._drawBars(this.waveformColor,s)}else this._drawBars(this.waveformProgressColor,0,e),this._drawBars(this.waveformColor,e);if(null!==this.selectionStart&&null!==this.selectionEnd){const t=Math.min(this.selectionStart,this.selectionEnd),e=Math.max(this.selectionStart,this.selectionEnd);this._drawBars(this.loopColor,t,e+1)}}window.requestAnimationFrame(this.drawWaveform.bind(this))},this._drawBars=function(t,e,s){void 0!==s&&null!==s||(s=this.waveform.length),this.ctx.fillStyle=t;for(var i=e;i<s;i++)this._drawBar(this.ctx,i*this.barWidth+i*this.padding,this.canvas.height/2,this.barWidth,this.scale*this.waveform.data[i])},this._drawBar=function(t,e,s,i,a){t.fillRect(e+this.padding,s,i,a),t.fillRect(e+this.padding,s,i,-a)}}setupTypedArray("Float32Array","WebGLFloatArray"),setupTypedArray("Int32Array","WebGLIntArray"),setupTypedArray("Uint16Array","WebGLUnsignedShortArray"),setupTypedArray("Uint8Array","WebGLUnsignedByteArray"),DSP.invert=function(t){for(var e=0,s=t.length;e<s;e++)t[e]*=-1;return t},DSP.interleave=function(t,e){if(t.length!==e.length)throw"Can not interleave. Channel lengths differ.";for(var s=new Float32Array(2*t.length),i=0,a=t.length;i<a;i++)s[2*i]=t[i],s[2*i+1]=e[i];return s},DSP.deinterleave=function(){var t,e,s,i=[];return i[DSP.MIX]=function(t){for(var e=0,i=t.length/2;e<i;e++)s[e]=(t[2*e]+t[2*e+1])/2;return s},i[DSP.LEFT]=function(e){for(var s=0,i=e.length/2;s<i;s++)t[s]=e[2*s];return t},i[DSP.RIGHT]=function(t){for(var s=0,i=t.length/2;s<i;s++)e[s]=t[2*s+1];return e},function(a,n){return t=t||new Float32Array(n.length/2),e=e||new Float32Array(n.length/2),s=s||new Float32Array(n.length/2),n.length/2!==t.length&&(t=new Float32Array(n.length/2),e=new Float32Array(n.length/2),s=new Float32Array(n.length/2)),i[a](n)}}(),DSP.getChannel=DSP.deinterleave,DSP.mixSampleBuffers=function(t,e,s,i){for(var a=new Float32Array(t),n=0;n<t.length;n++)a[n]+=(s?-e[n]:e[n])/i;return a},DSP.LPF=0,DSP.HPF=1,DSP.BPF_CONSTANT_SKIRT=2,DSP.BPF_CONSTANT_PEAK=3,DSP.NOTCH=4,DSP.APF=5,DSP.PEAKING_EQ=6,DSP.LOW_SHELF=7,DSP.HIGH_SHELF=8,DSP.Q=1,DSP.BW=2,DSP.S=3,DSP.RMS=function(t){for(var e=0,s=0,i=t.length;s<i;s++)e+=t[s]*t[s];return Math.sqrt(e/i)},DSP.Peak=function(t){for(var e=0,s=0,i=t.length;s<i;s++)e=Math.abs(t[s])>e?Math.abs(t[s]):e;return e},DFT.prototype.forward=function(t){for(var e,s,i=this.real,a=this.imag,n=0;n<this.bufferSize/2;n++){e=0,s=0;for(var h=0;h<t.length;h++)e+=this.cosTable[n*h]*t[h],s+=this.sinTable[n*h]*t[h];i[n]=e,a[n]=s}return this.calculateSpectrum()},FFT.prototype.forward=function(t){var e=this.bufferSize,s=this.cosTable,i=this.sinTable,a=this.reverseTable,n=this.real,h=this.imag,r=(this.spectrum,Math.floor(Math.log(e)/Math.LN2));if(Math.pow(2,r)!==e)throw"Invalid buffer size, must be a power of 2.";if(e!==t.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+e+" Buffer Size: "+t.length;var o,l,u,c,f,p,d,m,y,g=1;for(y=0;y<e;y++)n[y]=t[a[y]],h[y]=0;for(;g<e;){o=s[g],l=i[g],u=1,c=0;for(var v=0;v<g;v++){for(y=v;y<e;)p=u*n[f=y+g]-c*h[f],d=u*h[f]+c*n[f],n[f]=n[y]-p,h[f]=h[y]-d,n[y]+=p,h[y]+=d,y+=g<<1;u=(m=u)*o-c*l,c=m*l+c*o}g<<=1}return this.calculateSpectrum()},FFT.prototype.inverse=function(t,e,s){var i=this.bufferSize,a=this.cosTable,n=this.sinTable,h=this.reverseTable;this.spectrum;t=t||this.real,e=e||this.imag;var r,o,l,u,c,f,p,d,m,y=1;for(m=0;m<i;m++)e[m]*=-1;var g=new Float32Array(i),v=new Float32Array(i);for(m=0;m<t.length;m++)g[m]=t[h[m]],v[m]=e[h[m]];for(t=g,e=v;y<i;){r=a[y],o=n[y],l=1,u=0;for(var S=0;S<y;S++){for(m=S;m<i;)f=l*t[c=m+y]-u*e[c],p=l*e[c]+u*t[c],t[c]=t[m]-f,e[c]=e[m]-p,t[m]+=f,e[m]+=p,m+=y<<1;l=(d=l)*r-u*o,u=d*o+u*r}y<<=1}for(m=0;m<i;m++)s[m]=t[m]/i;return s},RFFT.prototype.forward=function(t){var e,s,i,a,n,h,r,o,l,u,c,f,p,d,m,y,g,v,S,b,P,w,_,F,A,D,T=this.bufferSize,M=this.spectrum,I=this.trans,E=2*Math.PI,L=Math.sqrt,B=T>>>1,R=2/T;this.reverseBinPermute(I,t);for(var O=0,C=4;O<T;C*=4){for(var k=O;k<T;k+=C)g=I[k]-I[k+1],I[k]+=I[k+1],I[k+1]=g;O=2*(C-1)}for(e=2,a=T>>>1;a>>>=1;){O=0,C=(e<<=1)<<1,s=e>>>2,i=e>>>3;do{if(1!==s)for(k=O;k<T;k+=C)f=(c=(u=(l=k)+s)+s)+s,n=I[c]+I[f],I[f]-=I[c],I[c]=I[l]-n,I[l]+=n,l+=i,u+=i,f+=i,n=I[c+=i]+I[f],h=I[c]-I[f],n=-n*Math.SQRT1_2,h*=Math.SQRT1_2,g=I[u],I[f]=n+g,I[c]=n-g,I[u]=I[l]-h,I[l]+=h;else for(k=O;k<T;k+=C)f=(c=(u=(l=k)+s)+s)+s,n=I[c]+I[f],I[f]-=I[c],I[c]=I[l]-n,I[l]+=n;O=(C<<1)-e,C<<=2}while(O<T);w=E/e;for(var z=1;z<i;z++){_=z*w,S=Math.sin(_),b=4*(v=Math.cos(_))*(v*v-.75),P=4*S*(.75-S*S),O=0,C=e<<1;do{for(k=O;k<T;k+=C)f=(c=(u=(l=k+z)+s)+s)+s,y=(m=(d=(p=k+s-z)+s)+s)+s,h=I[m]*v-I[c]*S,n=I[m]*S+I[c]*v,o=I[y]*b-I[f]*P,r=I[y]*P+I[f]*b,g=h-o,h+=o,o=g,I[y]=h+I[d],I[c]=h-I[d],g=r-n,n+=r,r=g,I[f]=r+I[u],I[m]=r-I[u],I[d]=I[l]-n,I[l]+=n,I[u]=o+I[p],I[p]-=o;O=(C<<1)-e,C<<=2}while(O<T)}}for(;--B;)(D=R*L((F=I[B])*F+(A=I[T-B-1])*A))>this.peak&&(this.peakBand=B,this.peak=D),M[B]=D;return M[0]=R*I[0],M},Sampler.prototype.applyEnvelope=function(){return this.envelope.process(this.signal),this.signal},Sampler.prototype.generate=function(){this.frameCount,this.bufferSize;for(var t=this.playEnd*this.samples.length-this.playStart*this.samples.length,e=this.playStart*this.samples.length,s=this.playEnd*this.samples.length,i=0;i<this.bufferSize;i++){switch(this.loopMode){case DSP.OFF:this.playhead=Math.round(this.samplesProcessed*this.step+e),this.playhead<this.playEnd*this.samples.length?this.signal[i]=this.samples[this.playhead]*this.amplitude:this.signal[i]=0;break;case DSP.FW:this.playhead=Math.round(this.samplesProcessed*this.step%t+e),this.playhead<this.playEnd*this.samples.length&&(this.signal[i]=this.samples[this.playhead]*this.amplitude);break;case DSP.BW:this.playhead=s-Math.round(this.samplesProcessed*this.step%t),this.playhead<this.playEnd*this.samples.length&&(this.signal[i]=this.samples[this.playhead]*this.amplitude);break;case DSP.FWBW:Math.floor(this.samplesProcessed*this.step/t)%2==0?this.playhead=Math.round(this.samplesProcessed*this.step%t+e):this.playhead=s-Math.round(this.samplesProcessed*this.step%t),this.playhead<this.playEnd*this.samples.length&&(this.signal[i]=this.samples[this.playhead]*this.amplitude)}this.samplesProcessed++}return this.frameCount++,this.signal},Sampler.prototype.setFreq=function(t){var e=this.samplesProcessed*this.step;this.frequency=t,this.step=this.frequency/this.rootFrequency,this.samplesProcessed=Math.round(e/this.step)},Sampler.prototype.reset=function(){this.samplesProcessed=0,this.playhead=0},Oscillator.prototype.setAmp=function(t){if(!(t>=0&&t<=1))throw"Amplitude out of range (0..1).";this.amplitude=t},Oscillator.prototype.setFreq=function(t){this.frequency=t,this.cyclesPerSample=t/this.sampleRate},Oscillator.prototype.add=function(t){for(var e=0;e<this.bufferSize;e++)this.signal[e]+=t.signal[e];return this.signal},Oscillator.prototype.addSignal=function(t){for(var e=0;e<t.length&&!(e>=this.bufferSize);e++)this.signal[e]+=t[e];return this.signal},Oscillator.prototype.addEnvelope=function(t){this.envelope=t},Oscillator.prototype.applyEnvelope=function(){this.envelope.process(this.signal)},Oscillator.prototype.valueAt=function(t){return this.waveTable[t%this.waveTableLength]},Oscillator.prototype.generate=function(){for(var t,e=this.frameCount*this.bufferSize,s=this.waveTableLength*this.frequency/this.sampleRate,i=0;i<this.bufferSize;i++)t=Math.round((e+i)*s),this.signal[i]=this.waveTable[t%this.waveTableLength]*this.amplitude;return this.frameCount++,this.signal},Oscillator.Sine=function(t){return Math.sin(DSP.TWO_PI*t)},Oscillator.Square=function(t){return t<.5?1:-1},Oscillator.Saw=function(t){return 2*(t-Math.round(t))},Oscillator.Triangle=function(t){return 1-4*Math.abs(Math.round(t)-t)},Oscillator.Pulse=function(t){},ADSR.prototype.noteOn=function(){this.samplesProcessed=0,this.sustainSamples=this.sustainLength*this.sampleRate,this.update()},ADSR.prototype.noteOff=function(){this.sustainSamples=this.samplesProcessed-this.decaySamples,this.update()},ADSR.prototype.processSample=function(t){var e=0;return this.samplesProcessed<=this.attack?e=0+(this.samplesProcessed-0)/(this.attack-0)*1:this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?e=1+(this.sustainLevel-1)*((this.samplesProcessed-this.attack)/(this.decay-this.attack)):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?e=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(e=this.sustainLevel+(0-this.sustainLevel)*((this.samplesProcessed-this.sustain)/(this.release-this.sustain))),t*e},ADSR.prototype.value=function(){var t=0;return this.samplesProcessed<=this.attack?t=0+(this.samplesProcessed-0)/(this.attack-0)*1:this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?t=1+(this.sustainLevel-1)*((this.samplesProcessed-this.attack)/(this.decay-this.attack)):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?t=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(t=this.sustainLevel+(0-this.sustainLevel)*((this.samplesProcessed-this.sustain)/(this.release-this.sustain))),t},ADSR.prototype.process=function(t){for(var e=0;e<t.length;e++)t[e]*=this.value(),this.samplesProcessed++;return t},ADSR.prototype.isActive=function(){return!(this.samplesProcessed>this.release||-1===this.samplesProcessed)},ADSR.prototype.disable=function(){this.samplesProcessed=-1},IIRFilter.prototype.__defineGetter__("cutoff",function(){return this.func.cutoff}),IIRFilter.prototype.__defineGetter__("resonance",function(){return this.func.resonance}),IIRFilter.prototype.set=function(t,e){this.func.calcCoeff(t,e)},IIRFilter.prototype.process=function(t){this.func.process(t)},IIRFilter.prototype.addEnvelope=function(t){if(!(t instanceof ADSR))throw"Not an envelope.";this.func.addEnvelope(t)},IIRFilter.LP12=function(t,e,s){this.sampleRate=s,this.vibraPos=0,this.vibraSpeed=0,this.envelope=!1,this.calcCoeff=function(t,e){this.w=2*Math.PI*t/this.sampleRate,this.q=1-this.w/(2*(e+.5/(1+this.w))+this.w-2),this.r=this.q*this.q,this.c=this.r+1-2*Math.cos(this.w)*this.q,this.cutoff=t,this.resonance=e},this.calcCoeff(t,e),this.process=function(t){for(var e=0;e<t.length;e++)this.vibraSpeed+=(t[e]-this.vibraPos)*this.c,this.vibraPos+=this.vibraSpeed,this.vibraSpeed*=this.r,this.envelope?(t[e]=t[e]*(1-this.envelope.value())+this.vibraPos*this.envelope.value(),this.envelope.samplesProcessed++):t[e]=this.vibraPos}},IIRFilter.LP12.prototype.addEnvelope=function(t){this.envelope=t},IIRFilter2.prototype.process=function(t){for(var e,s,i=this.f,a=0;a<t.length;a++)e=t[a],i[3]=e-this.damp*i[2],i[0]=i[0]+this.freq*i[2],i[1]=i[3]-i[0],i[2]=this.freq*i[1]+i[2],s=.5*i[this.type],i[3]=e-this.damp*i[2],i[0]=i[0]+this.freq*i[2],i[1]=i[3]-i[0],i[2]=this.freq*i[1]+i[2],s+=.5*i[this.type],this.envelope?(t[a]=t[a]*(1-this.envelope.value())+s*this.envelope.value(),this.envelope.samplesProcessed++):t[a]=s},IIRFilter2.prototype.addEnvelope=function(t){if(!(t instanceof ADSR))throw"This is not an envelope.";this.envelope=t},IIRFilter2.prototype.set=function(t,e){this.calcCoeff(t,e)},WindowFunction.prototype.process=function(t){for(var e=t.length,s=0;s<e;s++)t[s]*=this.func(e,s,this.alpha);return t},WindowFunction.Bartlett=function(t,e){return 2/(t-1)*((t-1)/2-Math.abs(e-(t-1)/2))},WindowFunction.BartlettHann=function(t,e){return.62-.48*Math.abs(e/(t-1)-.5)-.38*Math.cos(DSP.TWO_PI*e/(t-1))},WindowFunction.Blackman=function(t,e,s){var i=s/2;return(1-s)/2-.5*Math.cos(DSP.TWO_PI*e/(t-1))+i*Math.cos(4*Math.PI*e/(t-1))},WindowFunction.Cosine=function(t,e){return Math.cos(Math.PI*e/(t-1)-Math.PI/2)},WindowFunction.Gauss=function(t,e,s){return Math.pow(Math.E,-.5*Math.pow((e-(t-1)/2)/(s*(t-1)/2),2))},WindowFunction.Hamming=function(t,e){return.54-.46*Math.cos(DSP.TWO_PI*e/(t-1))},WindowFunction.Hann=function(t,e){return.5*(1-Math.cos(DSP.TWO_PI*e/(t-1)))},WindowFunction.Lanczos=function(t,e){var s=2*e/(t-1)-1;return Math.sin(Math.PI*s)/(Math.PI*s)},WindowFunction.Rectangular=function(t,e){return 1},WindowFunction.Triangular=function(t,e){return 2/t*(t/2-Math.abs(e-(t-1)/2))},DSP.mag2db=function(t){for(var e=Math.pow(10,-6),s=Math.log,i=Math.max,a=Float32Array(t.length),n=0;n<t.length;n++)a[n]=20*s(i(t[n],e));return a},DSP.freqz=function(t,e,s){var i,a;if(!s)for(s=Float32Array(200),i=0;i<s.length;i++)s[i]=DSP.TWO_PI/s.length*i-Math.PI;var n=Float32Array(s.length),h=Math.sqrt,r=Math.cos,o=Math.sin;for(i=0;i<s.length;i++){var l={real:0,imag:0};for(a=0;a<t.length;a++)l.real+=t[a]*r(-a*s[i]),l.imag+=t[a]*o(-a*s[i]);var u={real:0,imag:0};for(a=0;a<e.length;a++)u.real+=e[a]*r(-a*s[i]),u.imag+=e[a]*o(-a*s[i]);n[i]=h(l.real*l.real+l.imag*l.imag)/h(u.real*u.real+u.imag*u.imag)}return n},MultiDelay.prototype.setDelayInSamples=function(t){this.delayInSamples=t,this.delayInputPointer=this.delayOutputPointer+t,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},MultiDelay.prototype.setMasterVolume=function(t){this.masterVolume=t},MultiDelay.prototype.setDelayVolume=function(t){this.delayVolume=t},MultiDelay.prototype.process=function(t){for(var e=new Float32Array(t.length),s=0;s<t.length;s++){var i=(null===this.delayBufferSamples[this.delayOutputPointer]?0:this.delayBufferSamples[this.delayOutputPointer])*this.delayVolume+t[s];this.delayBufferSamples[this.delayInputPointer]=i,e[s]=i*this.masterVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0)}return e},SingleDelay.prototype.setDelayInSamples=function(t){this.delayInSamples=t,this.delayInputPointer=this.delayOutputPointer+t,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},SingleDelay.prototype.setDelayVolume=function(t){this.delayVolume=t},SingleDelay.prototype.process=function(t){for(var e=new Float32Array(t.length),s=0;s<t.length;s++){this.delayBufferSamples[this.delayInputPointer]=t[s];var i=this.delayBufferSamples[this.delayOutputPointer];e[s]=i*this.delayVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0)}return e},Reverb.prototype.setDelayInSamples=function(t){var e,s;for(this.delayInSamples=t,e=0;e<this.NR_OF_SINGLEDELAYS;e++)s=1+e/7,this.singleDelays[e].setDelayInSamples(Math.round(this.delayInSamples*s));for(e=0;e<this.NR_OF_MULTIDELAYS;e++)s=1+e/10,this.multiDelays[e].setDelayInSamples(Math.round(this.delayInSamples*s))},Reverb.prototype.setMasterVolume=function(t){this.masterVolume=t},Reverb.prototype.setMixVolume=function(t){this.mixVolume=t},Reverb.prototype.setDelayVolume=function(t){var e;for(this.delayVolume=t,e=0;e<this.NR_OF_SINGLEDELAYS;e++)this.singleDelays[e].setDelayVolume(this.delayVolume);for(e=0;e<this.NR_OF_MULTIDELAYS;e++)this.multiDelays[e].setDelayVolume(this.delayVolume)},Reverb.prototype.setDampFrequency=function(t){this.dampFrequency=t,this.LOWPASSL.set(t,0),this.LOWPASSR.set(t,0)},Reverb.prototype.process=function(t){var e=new Float32Array(t.length),s=DSP.deinterleave(t);this.LOWPASSL.process(s[DSP.LEFT]),this.LOWPASSR.process(s[DSP.RIGHT]);var i,a=DSP.interleave(s[DSP.LEFT],s[DSP.RIGHT]);for(i=0;i<this.NR_OF_MULTIDELAYS;i++)e=DSP.mixSampleBuffers(e,this.multiDelays[i].process(a),2%i==0,this.NR_OF_MULTIDELAYS);var n=new Float32Array(e.length);for(i=0;i<this.NR_OF_SINGLEDELAYS;i++)n=DSP.mixSampleBuffers(n,this.singleDelays[i].process(e),2%i==0,1);for(i=0;i<n.length;i++)n[i]*=this.mixVolume;for(e=DSP.mixSampleBuffers(n,t,0,1),i=0;i<e.length;i++)e[i]*=this.masterVolume;return e},function(){const t=new(window.AudioContext||window.webkitAudioContext),e=document.querySelector("canvas");var s=null,i=null,a=null,n="";function h(e){t.decodeAudioData(e,r,o)}function r(a){hideElement("loadingDiv"),showElement("musicDiv"),(s=new Song(t,a,e)).onStart(d),s.onStop(d),(i=new Renderer(e,s)).drawWaveform(),document.getElementById("timeSpan").innerHTML=`0:00/${formatTime(s.duration)}`,document.getElementById("songName").innerHTML=`<strong>${n}</strong>`}function o(t){hideElement("loadingDiv");const e=document.getElementById("errorDiv");showElement(e),e.innerHTML="Error decoding song",console.log("error decoding song")}const l=document.getElementById("fileInput");l.addEventListener("change",c);const u=document.getElementById("drop_zone");function c(){const t=this.files;if(0===t.length)return;hideElement("errorDiv"),s&&(s.stop(),s=null);const e=t[0],i=new FileReader;showElement("loadingDiv"),i.addEventListener("load",t=>{h(t.target.result)}),i.readAsArrayBuffer(e),n=e.name}u.addEventListener("drop",t=>{if(u.style.backgroundColor="#7ecf7a",u.classList.remove("bg-success"),t.preventDefault(),t.dataTransfer.files&&t.dataTransfer.files.length>0){let e=t.dataTransfer.files[0];c.call({files:[e]})}}),u.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy",u.classList.add("bg-success"),u.style.backgroundColor=""}),u.addEventListener("dragleave",t=>{t.preventDefault(),u.style.backgroundColor="#7ecf7a",u.classList.remove("bg-success")}),$("#drop_zone").click(()=>{$(l).click()});const f=document.getElementById("playButton");function p(){s&&(s.isPlaying?(s.stop(),-1!==T&&(clearInterval(T),T=-1,b(A,s.position))):s.play())}function d(){s&&(s.isPlaying?(f.innerHTML='<i class="fas fa-pause-circle"></i>',a=setInterval(y,200,s)):(f.innerHTML='<i class="fas fa-play-circle"></i>',clearInterval(a)))}f.addEventListener("click",p);var m=null;function y(t){var e=m;null===e&&(e=t.position),e=formatTime(e),document.getElementById("timeSpan").innerHTML=e+"/"+formatTime(t.duration)}e.addEventListener("mousemove",function(t){if(s){var e=F(t);null!==i&&(i.selectionBar=e,m=w(i.selectionBar),y(s)),v&&Date.now()-g>300&&(i.selectionBar=null,i.selectionStart=S,i.selectionEnd=e)}}),e.addEventListener("mouseleave",function(t){s&&(i&&(i.selectionBar=null),m=null,y(s))});var g=null,v=!1,S=null;function b(t,e){i.selectionStart=null,i.selectionEnd=null,i.loopStart=_(t),i.loopEnd=_(e),s.stop(),s.loop(t,e),s.play(s.loopStart),document.getElementById("loopStart").innerHTML=formatTime(t),document.getElementById("loopEnd").innerHTML=formatTime(e),showElement("loopDiv")}function P(){s&&s.looping&&(s.unloop(),i.loopStart=null,i.loopEnd=null,hideElement("loopDiv"))}function w(t){return t*(s.duration/s.waveform.length)}function _(t){return Math.floor(t*(s.waveform.length/s.duration))}function F(t){return Math.floor(function(t,e,s){const i=s.getClientRects()[0];return t-=i.x,e-=i.y,{x:t*(s.width/i.width),y:e*(s.height/i.height)}}(t.clientX,t.clientY,e).x*(s.waveform.length/e.width))}e.addEventListener("mousedown",function(t){s&&(v=!0,g=Date.now(),S=F(t))}),e.addEventListener("mouseup",function(t){if(s)if(v=!1,Date.now()-g<=300){var e=w(F(t));if(!s.isPlaying)return void s.play(e);s.looping&&(e<s.loopStart||e>s.loopEnd)&&P(),s.seek(e),y(s)}else{const t=Math.min(i.selectionStart,i.selectionEnd),e=Math.max(i.selectionStart,i.selectionEnd);b(w(t),w(e))}});var A,D,T=-1;function M(t){i.selectionEnd=_(t.position),D=t.position}document.querySelector("body").onkeydown=function(t){if(s)switch(t.key){case" ":t.preventDefault(),p();break;case"Backspace":t.preventDefault(),P(),i&&i.drawWaveform(i);break;case"ArrowLeft":t.preventDefault(),s.seek(s.position-5);break;case"ArrowRight":t.preventDefault(),s.seek(s.position+5);break;case"l":s.isPlaying&&!s.looping&&(-1===T?(A=s.position,i.selectionStart=_(s.position),T=setInterval(M,20,s)):-1!==T&&(D=s.position,clearInterval(T),T=-1,b(A,D)));break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s.seek(t.key/10*s.duration)}};const I=document.getElementsByClassName("playbackButton");let E=2;function L(t){if(!s)return;let e=document.getElementById("custom-speed");if(e.classList.contains("btn-warning")&&(e.classList.remove("btn-warning"),e.classList.add("btn-secondary")),E>-1&&E<I.length){let t=I.item(E);t.classList.remove("btn-warning"),t.classList.add("btn-secondary")}let i=t.target;i.classList.remove("btn-secondary"),i.classList.add("btn-warning"),s.changePlayback(i.value);for(let t=0;t<I.length;t++){I.item(t).classList.contains("btn-warning")&&(E=t)}}for(let t=0;t<I.length;t++)I.item(t).addEventListener("click",L);const B=document.createElement("div"),R=document.createElement("span");B.className="text-center";const O=document.createElement("input");O.type="range",O.max=2,O.min=.4,O.step=.05,O.oninput=function(){R.innerHTML=this.value+"x"},O.onchange=function(){s&&s.changePlayback(this.value)},B.appendChild(R),B.appendChild(document.createElement("br")),B.appendChild(O),$("#custom-speed").popover({placement:"top",html:!0,content:B,trigger:"manual"});let C=!0;$("#custom-speed").click(function(){if(C=!1,E>-1&&E<I.length){let t=I.item(E);t.classList.remove("btn-warning"),t.classList.add("btn-secondary")}this.classList.remove("btn-secondary"),this.classList.add("btn-warning"),$(this).popover("toggle")}),$("#custom-speed").on("inserted.bs.popover",function(){O.value=s.playback,R.innerHTML=O.value+"x"}),$("#custom-speed").on("shown.bs.popover",function(){$(".popover").click(()=>{C=!1})}),$("html").click(()=>{C&&$("#custom-speed").popover("hide"),C=!0}),function(){const t=new XMLHttpRequest;t.open("GET","audio/songturtle.mp3",!0),n="songturtle.mp3",t.onload=function(){h(t.response)},t.responseType="arraybuffer",t.send()}()}();